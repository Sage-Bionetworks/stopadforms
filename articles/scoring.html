<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scoring submissions • stopadforms</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Scoring submissions">
<meta property="og:description" content="stopadforms">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stopadforms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/deploying-stopadforms.html">Deploying stopadforms</a>
    </li>
    <li>
      <a href="../articles/scoring.html">Scoring submissions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Sage-Bionetworks/stopadforms/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="scoring_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Scoring submissions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Sage-Bionetworks/stopadforms/blob/master/vignettes/scoring.Rmd"><code>vignettes/scoring.Rmd</code></a></small>
      <div class="hidden name"><code>scoring.Rmd</code></div>

    </div>

    
    
<p>This vignette describes the scoring algorithm used by STOP-AD. Here a “submission” refers to an application submitted to the <a href="https://stopadportal.synapse.org/">STOP-AD Compound Submission Portal</a>. Submissions are scored by a panel of reviewers, and the final score is aggregated based on these reviews.</p>
<div id="scoring-sections-of-a-submission" class="section level2">
<h2 class="hasAnchor">
<a href="#scoring-sections-of-a-submission" class="anchor"></a>Scoring sections of a submission</h2>
<p>Reviewers give ratings to submissions on a section-by-section basis. That is, they score the Binding, LD50, PK In Vivo, etc. sections independently. They rate each section as None (no data; 0), Poor (0.1), Fair (0.25), Good (0.85), or Excellent (1). Reviewers can abstain from reviewing a section if they feel they cannot rate it. Reviewers also record whether the section contains data from within or across species.</p>
<p>The score for a section is generally determined by several factors: the rating given by the reviewer, whether the data is within- or across-species (referred to as the “species multiplier”: 0.67 if within-species, 0.33 if across), whether the compound is available for off-label use (referred to as the “clinical multiplier”: 0.67 if yes, 0.33 if no), and the partial beta weights of fields within the section (contained in the <code>partial_betas</code> table within this R package; these were originally sourced from the scoring spreadsheet upon which this scoring system was derived).</p>
<p>However, there are exceptions to the above: the Naming, Basic Data, PK In Silico, and PK In Vitro sections do not use the clinical or species multipliers, so these multipliers are set to 1 in the calculations.</p>
<p>Most of the time, the contents of the submission itself do not directly affect the score; it is the reviewer’s rating of those contents that affect the score. But, there are exceptions. The main exception is the clinical multiplier, which is derived from the answer to the question “Is this compound available for off label use?”. The clinical multiplier affects the scoring of most sections. In the other exceptions, the partial beta weight for a field is not drawn from the <code>partial_betas</code> table, but rather derived from the data. This is the case for the efficacy measure (EC50 gets a weight of 0.67, IC50: 0.33) and therapeutic approach (prophylactic: 0.4, symptomatic: 0.2, both: 0.3, unknown: 0.1).</p>
<p>Most sections are equally weighted relative to each other, but the 3 PK sections—PK In Vivo, PK In Vitro, PK In Silico—are weighted differently. They are treated as 3 components of a larger section, with PK In Silico getting a weight of 0.17, PK In Vitro getting a weight of 0.33, and PK In Vivo getting a weight of 0.5. These weights are referred to as the “section multiplier”; for the rest of the sections in the submission, the section multiplier is 1.</p>
<p>Some sections (Acute Dosing, Chronic Dosing, and Teratogenicity) do not assign partial beta weights for individual fields. Instead, if there is any data provided for the section at all the partial beta is set to 1.</p>
<p>The score of a section for a given reviewer is calculated by multiplying the section multiplier, clinical multiplier, species multiplier, and reviewer score by the vector of partial beta weights for the questions within that section. This multiplication results in a vector of numbers, the sum of which produces the score for the section. We repeat this process for all sections of the submission and all reviews.</p>
</div>
<div id="aggregating-across-reviewers" class="section level2">
<h2 class="hasAnchor">
<a href="#aggregating-across-reviewers" class="anchor"></a>Aggregating across reviewers</h2>
<p>The previous section describes how we calculate the score for each section based on a single reviewer’s rating. The next step in scoring is to aggregate the section scores across multiple reviewers. For each section of a submission, we take the geometric mean of the scores that were calculated for each reviewer. Where <code>values</code> is a vector of scores for the current section, the geometric mean is calculated by:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This leaves us with a single score for each section of the submission.</p>
</div>
<div id="final-score" class="section level2">
<h2 class="hasAnchor">
<a href="#final-score" class="anchor"></a>Final score</h2>
<p>The final step in scoring is to add up the section scores from the previous section and divide by a denominator. Again, at this point the section scores are the geometric means of the scores from the different reviewers.</p>
<p>The base denominator is 11, which corresponds to the number of sections in a submission, but with the 3 PK sections together making 1, and with the Basic Data section getting double weight. The clinical data and metadata sections are not scored, so they are not included in the denominator.</p>
<p>A submission can have different numbers of sections, however, because applicants can add extra sections if they have multiple experiments to report. Thus the denominator can vary. If someone included two binding experiments, then the denominator would be 12. If they included 2 PK In Vivo sections, it would be 11.5.</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Below is a more real-world example that shows how to score submissions that are stored by Synapse. To run this, you will need to have Python and the <a href="https://python-docs.synapse.org/build/html/index.html">synapseclient</a> Python package installed, as stopadforms uses this package to interact with <a href="https://www.synapse.org">Synapse</a>. You will also need to be part of the STOP-AD_Reviewers team on Synapse (<a href="https://www.synapse.org/#!Team:3403721" class="uri">https://www.synapse.org/#!Team:3403721</a>)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rstudio/reticulate">"reticulate"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://sage-bionetworks.github.io/stopadforms">"stopadforms"</a></span><span class="op">)</span>

<span class="co"># Optional: use reticulate::use_python() here to tell R which Python version you</span>
<span class="co"># want to use. Again, the synapseclient Python package must be installed as</span>
<span class="co"># well.</span>

<span class="va">synapse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/import.html">import</a></span><span class="op">(</span><span class="st">"synapseclient"</span><span class="op">)</span> <span class="co"># load the synapseclient python package</span>
<span class="va">syn</span> <span class="op">&lt;-</span> <span class="va">synapse</span><span class="op">$</span><span class="fu">Synapse</span><span class="op">(</span><span class="op">)</span>
<span class="va">syn</span><span class="op">$</span><span class="fu">login</span><span class="op">(</span><span class="op">)</span>                        <span class="co"># authenticate to Synapse</span>

<span class="co">## Get rejected submissions (rejected submissions include a test submission I</span>
<span class="co">## created).</span>
<span class="va">sub_data_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_submissions.html">get_submissions</a></span><span class="op">(</span>
  <span class="va">syn</span>,
  group <span class="op">=</span> <span class="fl">9</span>,
  statuses <span class="op">=</span> <span class="st">"REJECTED"</span>
<span class="op">)</span>

<span class="co">## The above command returns a list of pre-signed URLs to the raw JSON data for</span>
<span class="co">## the submissions. These URLs are ephemeral and expire after a short period of</span>
<span class="co">## time, so if you experience 403 permissions errors trying to use them, it may</span>
<span class="co">## be because they have expired and you'll need to re-run the above command.</span>

<span class="co">## Convert to data frame</span>
<span class="va">dat_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_submissions.html">process_submissions</a></span><span class="op">(</span>
  <span class="va">sub_data_files</span>,
  lookup_table <span class="op">=</span> <span class="fu">stopadforms</span><span class="fu">:::</span><span class="va"><a href="../reference/lookup_table.html">lookup_table</a></span>,
  complete <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co">## Filter to one submission of interest -- a test submission I created.</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">dat_full</span>, <span class="va">form_data_id</span> <span class="op">==</span> <span class="st">"242"</span><span class="op">)</span>

<span class="co">## Append clinical modifier used in calculations</span>
<span class="va">submission</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/append_clinical_to_submission.html">append_clinical_to_submission</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>

<span class="co">## Get section scores</span>
<span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pull_reviews_table.html">pull_reviews_table</a></span><span class="op">(</span><span class="va">syn</span>, <span class="st">"syn22014561"</span>, <span class="va">submission</span><span class="op">)</span>

<span class="co">## Calculate overall score</span>
<span class="fu"><a href="../reference/calculate_submission_score.html">calculate_submission_score</a></span><span class="op">(</span><span class="va">submission</span>, <span class="va">scores</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kara Woo, Nicole Kauer, Phil Snyder.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
